!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Speech=e():t.Speech=e()}(window,(function(){return function(t){var e={};function o(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=t,o.c=e,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)o.d(i,n,function(e){return t[e]}.bind(null,n));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=0)}([function(t,e,o){const i=o(1),n=o(2);t.exports={Recognizer:function({keys:t,onSpeechStart:e=(()=>console.log("voice_start")),onSpeechEnd:o=(()=>console.log("voice_stop")),onSpeechRecognized:r=(t=>console.log("onSpeechRecognized",t))}){navigator.getUserMedia({audio:!0},(function(s){const a=(new AudioContext).createMediaStreamSource(s),h=new i(a,{numChannels:1});function c(e){let o=new FileReader;o.onload=async function(){if(2==o.readyState){const e=new Uint8Array(o.result),i=await recognize(e,t.googleCloud[0]);r(i)}},o.readAsArrayBuffer(e)}n({source:a,voice_start:function(){e(),h.record()},voice_stop:function(){o(),h.stop(),h.exportWAV(c),h.clear()},DEBUG:!0})}),t=>{console.error("No live audio input in this browser: "+t)})}}},function(t,e){var o=function(t,e){var o=e||{},i=o.bufferLen||4096;this.context=t.context,this.node=(this.context.createScriptProcessor||this.context.createJavaScriptNode).call(this.context,i,2,2);var n=new Worker("./recorderWorker.js");n.onmessage=function(t){var e=t.data;r(e)},n.postMessage({command:"init",config:{sampleRate:this.context.sampleRate}});var r,s=!1;this.node.onaudioprocess=function(t){s&&n.postMessage({command:"record",buffer:[t.inputBuffer.getChannelData(0),t.inputBuffer.getChannelData(1)]})},this.configure=function(t){for(var e in t)t.hasOwnProperty(e)&&(o[e]=t[e])},this.record=function(){s=!0},this.stop=function(){s=!1},this.clear=function(){n.postMessage({command:"clear"})},this.getBuffer=function(t){r=t||o.callback,n.postMessage({command:"getBuffer"})},this.exportWAV=function(t,e){if(r=t||o.callback,e=e||o.type||"audio/wav",!r)throw new Error("Callback not set");n.postMessage({command:"exportWAV",type:e})},t.connect(this.node),this.node.connect(this.context.destination)};o.forceDownload=function(t,e){var o=(window.URL||window.webkitURL).createObjectURL(t),i=window.document.createElement("a");i.href=o,i.download=e||"output.wav";var n=document.createEvent("Event");n.initEvent("click",!0,!0),i.dispatchEvent(n)},t.exports=o},function(t,e){t.exports=function(t){for(var e in this.options={fftSize:512,bufferLen:512,voice_stop:function(){},voice_start:function(){},smoothingTimeConstant:.99,energy_offset:1e-8,energy_threshold_ratio_pos:2,energy_threshold_ratio_neg:.5,energy_integration:1,filter:[{f:200,v:0},{f:2e3,v:1}],source:null,context:null,DEBUG:!1},t)t.hasOwnProperty(e)&&(this.options[e]=t[e]);if(!this.options.source)throw new Error("The options must specify a MediaStreamAudioSourceNode.");this.options.context=this.options.source.context,this.hertzPerBin=this.options.context.sampleRate/this.options.fftSize,this.iterationFrequency=this.options.context.sampleRate/this.options.bufferLen,this.iterationPeriod=1/this.iterationFrequency,this.options.DEBUG&&console.log("Vad | sampleRate: "+this.options.context.sampleRate+" | hertzPerBin: "+this.hertzPerBin+" | iterationFrequency: "+this.iterationFrequency+" | iterationPeriod: "+this.iterationPeriod),this.setFilter=function(t){this.filter=[];for(var e=0,o=this.options.fftSize/2;e<o;e++){this.filter[e]=0;for(var i=0,n=t.length;i<n;i++)if(e*this.hertzPerBin<t[i].f){this.filter[e]=t[i].v;break}}},this.setFilter(this.options.filter),this.ready={},this.vadState=!1,this.energy_offset=this.options.energy_offset,this.energy_threshold_pos=this.energy_offset*this.options.energy_threshold_ratio_pos,this.energy_threshold_neg=this.energy_offset*this.options.energy_threshold_ratio_neg,this.voiceTrend=0,this.voiceTrendMax=10,this.voiceTrendMin=-10,this.voiceTrendStart=5,this.voiceTrendEnd=-5,this.analyser=this.options.context.createAnalyser(),this.analyser.smoothingTimeConstant=this.options.smoothingTimeConstant,this.analyser.fftSize=this.options.fftSize,this.floatFrequencyData=new Float32Array(this.analyser.frequencyBinCount),this.floatFrequencyDataLinear=new Float32Array(this.floatFrequencyData.length),this.options.source.connect(this.analyser),this.scriptProcessorNode=this.options.context.createScriptProcessor(this.options.bufferLen,1,1),this.scriptProcessorNode.connect(this.options.context.destination);var o=this;this.scriptProcessorNode.onaudioprocess=function(t){o.analyser.getFloatFrequencyData(o.floatFrequencyData),o.update(),o.monitor()},this.options.source.connect(this.scriptProcessorNode),this.logging=!1,this.log_i=0,this.log_limit=100,this.triggerLog=function(t){this.logging=!0,this.log_i=0,this.log_limit="number"==typeof t?t:this.log_limit},this.log=function(t){this.logging&&this.log_i<this.log_limit?(this.log_i++,console.log(t)):this.logging=!1},this.update=function(){for(var t=this.floatFrequencyData,e=0,o=t.length;e<o;e++)this.floatFrequencyDataLinear[e]=Math.pow(10,t[e]/10);this.ready={}},this.getEnergy=function(){if(this.ready.energy)return this.energy;for(var t=0,e=this.floatFrequencyDataLinear,o=0,i=e.length;o<i;o++)t+=this.filter[o]*e[o]*e[o];return this.energy=t,this.ready.energy=!0,t},this.monitor=function(){var t=this.getEnergy(),e=t-this.energy_offset;e>this.energy_threshold_pos?this.voiceTrend=this.voiceTrend+1>this.voiceTrendMax?this.voiceTrendMax:this.voiceTrend+1:e<-this.energy_threshold_neg?this.voiceTrend=this.voiceTrend-1<this.voiceTrendMin?this.voiceTrendMin:this.voiceTrend-1:this.voiceTrend>0?this.voiceTrend--:this.voiceTrend<0&&this.voiceTrend++;var o=!1,i=!1;this.voiceTrend>this.voiceTrendStart?o=!0:this.voiceTrend<this.voiceTrendEnd&&(i=!0);var n=e*this.iterationPeriod*this.options.energy_integration;return this.energy_offset+=n>0||!i?n:10*n,this.energy_offset=this.energy_offset<0?0:this.energy_offset,this.energy_threshold_pos=this.energy_offset*this.options.energy_threshold_ratio_pos,this.energy_threshold_neg=this.energy_offset*this.options.energy_threshold_ratio_neg,o&&!this.vadState&&(this.vadState=!0,this.options.voice_start()),i&&this.vadState&&(this.vadState=!1,this.options.voice_stop()),this.log("e: "+t+" | e_of: "+this.energy_offset+" | e+_th: "+this.energy_threshold_pos+" | e-_th: "+this.energy_threshold_neg+" | signal: "+e+" | int: "+n+" | voiceTrend: "+this.voiceTrend+" | start: "+o+" | end: "+i),e}}}])}));